# 系统架构文档

## 概述

本系统是一个面向隐私保护的轻量级检索增强生成（RAG）系统，采用模块化设计，支持本地部署，确保数据隐私和安全。

## 核心架构

### 数据流程

```
原始文档 → 解析 → 切块 → 加密 → 向量化 → 存储
                                    ↓
用户查询 → 向量化 → 检索 → 解密 → 上下文构建 → LLM生成 → 答案
```

## 模块详解

### 1. 文档处理层
- 支持多格式: TXT, PDF, DOCX, Markdown
- 智能切块与重叠
- 保留文档元数据

### 2. 加密层
- AES-256-GCM算法
- 密钥管理与派生
- 认证加密保证完整性

### 3. 向量化层
- Sentence Transformers模型
- 批量编码优化
- 多模型支持

### 4. 存储层
- Qdrant向量数据库
- 本地持久化
- 高效相似度搜索

### 5. 检索层
- Top-K相似度检索
- 自动解密
- 结果排序

### 6. 生成层
- Ollama本地LLM
- 4-bit量化支持
- 流式生成

### 7. RAG流程层
- 端到端问答
- 上下文管理
- 提示词优化

### 8. 审计层
- 完整日志记录
- SHA256链式哈希
- 完整性验证

### 9. 评估层
- 多维度指标
- 性能对比
- 基准测试

## 技术选型理由

### Ollama
- 完全本地部署
- 数据不出本地
- 无API费用

### Qdrant
- 轻量级部署
- 高效检索
- 易于使用

### Sentence Transformers
- 轻量级模型
- 高质量向量
- 多语言支持

### AES-GCM
- NIST标准
- 认证加密
- 硬件加速

## 安全设计

- 端到端加密
- 本地处理
- 审计追踪
- 完整性验证

## 性能优化

- 向量索引加速
- 批处理优化
- 模型量化
- 缓存机制

详细架构文档请参考完整版本。
