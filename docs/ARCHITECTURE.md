# 系统架构文档

## 系统概述

本系统是一个面向隐私保护的轻量级RAG（Retrieval-Augmented Generation）系统，采用模块化设计，确保数据安全的同时保持高效性能。

## 核心架构

### 模块划分

1. **文档处理层** - 解析和分块
2. **加密层** - 数据保护
3. **嵌入层** - 向量化
4. **存储层** - 向量数据库
5. **生成层** - LLM推理
6. **编排层** - RAG流程
7. **审计层** - 日志追踪
8. **表示层** - Web界面

### 数据流

#### 文档摄入流程
```
文档 → 解析 → 分块 → [向量化 + 加密] → 存储(向量+密文)
```

#### 查询流程
```
查询 → 向量化 → 检索 → 解密 → 构建上下文 → LLM生成 → 答案
```

## 隐私保护设计

### 1. 数据加密
- AES-256-GCM 加密算法
- 随机nonce确保安全性
- 密文与向量分离存储

### 2. 本地处理
- 所有操作本地完成
- 无网络数据传输
- 离线可用

### 3. 安全日志
- 仅记录元数据
- 敏感信息哈希化
- 完整性校验

## 性能优化

### 轻量化策略
1. 小参数量模型（22M embedding, 3B LLM）
2. 4-bit 量化技术
3. CPU优化的推理
4. 批量处理

### 资源占用
- 内存：约4-6GB
- 磁盘：模型约5GB
- CPU：4核心推荐

## 技术选型

| 组件 | 技术 | 原因 |
|------|-----|-----|
| 嵌入 | all-MiniLM-L6-v2 | 轻量、高效、质量好 |
| LLM | Llama 3.2 3B | 小参数、支持量化 |
| 向量库 | Qdrant | 高性能、易用、本地 |
| 加密 | AES-256-GCM | 标准、安全、快速 |
| Web | Streamlit | 简单、快速开发 |

详细架构设计请参考完整文档。
